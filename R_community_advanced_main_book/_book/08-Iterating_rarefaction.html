<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Iterating rarefaction | R community advanced analysis</title>
  <meta name="description" content="NEOF book for the R community advanced analysis course" />
  <meta name="generator" content="bookdown 0.36 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Iterating rarefaction | R community advanced analysis" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/figures/NEOF.png" />
  <meta property="og:description" content="NEOF book for the R community advanced analysis course" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Iterating rarefaction | R community advanced analysis" />
  
  <meta name="twitter:description" content="NEOF book for the R community advanced analysis course" />
  <meta name="twitter:image" content="/figures/NEOF.png" />

<meta name="author" content="Matthew R. Gemmell" />


<meta name="date" content="2024-06-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="figures/NEOF_favicon.png" type="image/x-icon" />
<link rel="prev" href="07-Rarefaction_and_random_seeds.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="www/webex.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="https://neof.org.uk/" target="blank"><img src="figures/NEOF_bordered_small.png"></a></li>
<li><a>R community analysis</a></li>

<li class="divider"></li>
<li class="part"><span><b>Intro</b></span></li>
<li class="chapter" data-level="1" data-path="01-R_community_advanced_main_book.html"><a href="01-R_community_advanced_main_book.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="01-R_community_advanced_main_book.html"><a href="01-R_community_advanced_main_book.html#table-of-contents"><i class="fa fa-check"></i>Table of contents</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="02-Dataset_and_workflow.html"><a href="02-Dataset_and_workflow.html"><i class="fa fa-check"></i><b>2</b> Dataset &amp; workflow</a>
<ul>
<li class="chapter" data-level="2.1" data-path="02-Dataset_and_workflow.html"><a href="02-Dataset_and_workflow.html#dataset"><i class="fa fa-check"></i><b>2.1</b> Dataset</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="02-Dataset_and_workflow.html"><a href="02-Dataset_and_workflow.html#sites"><i class="fa fa-check"></i><b>2.1.1</b> Sites</a></li>
<li class="chapter" data-level="2.1.2" data-path="02-Dataset_and_workflow.html"><a href="02-Dataset_and_workflow.html#culture-media"><i class="fa fa-check"></i><b>2.1.2</b> Culture media</a></li>
<li class="chapter" data-level="2.1.3" data-path="02-Dataset_and_workflow.html"><a href="02-Dataset_and_workflow.html#sum_and_qs"><i class="fa fa-check"></i><b>2.1.3</b> Summary &amp; questions</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="02-Dataset_and_workflow.html"><a href="02-Dataset_and_workflow.html#workflow"><i class="fa fa-check"></i><b>2.2</b> Workflow</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="03-R_packages.html"><a href="03-R_packages.html"><i class="fa fa-check"></i><b>3</b> R Packages</a>
<ul>
<li class="chapter" data-level="3.1" data-path="03-R_packages.html"><a href="03-R_packages.html#r-packageslibraries"><i class="fa fa-check"></i><b>3.1</b> R packages/libraries</a></li>
<li class="chapter" data-level="3.2" data-path="03-R_packages.html"><a href="03-R_packages.html#the-grammar-of-graphics"><i class="fa fa-check"></i><b>3.2</b> The grammar of graphics</a></li>
<li class="chapter" data-level="3.3" data-path="03-R_packages.html"><a href="03-R_packages.html#phyloseq"><i class="fa fa-check"></i><b>3.3</b> phyloseq</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="04-Setup.html"><a href="04-Setup.html"><i class="fa fa-check"></i><b>4</b> Set-up</a>
<ul>
<li class="chapter" data-level="4.1" data-path="04-Setup.html"><a href="04-Setup.html#cluster"><i class="fa fa-check"></i><b>4.1</b> Logon instructions</a></li>
<li class="chapter" data-level="4.2" data-path="04-Setup.html"><a href="04-Setup.html#mamba"><i class="fa fa-check"></i><b>4.2</b> Mamba</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="05-Jupyter.html"><a href="05-Jupyter.html"><i class="fa fa-check"></i><b>5</b> Jupyter</a>
<ul>
<li class="chapter" data-level="5.1" data-path="05-Jupyter.html"><a href="05-Jupyter.html#open-jupyter-notebook"><i class="fa fa-check"></i><b>5.1</b> Open Jupyter-notebook</a></li>
<li class="chapter" data-level="5.2" data-path="05-Jupyter.html"><a href="05-Jupyter.html#create-r-notebook"><i class="fa fa-check"></i><b>5.2</b> Create R notebook</a></li>
<li class="chapter" data-level="5.3" data-path="05-Jupyter.html"><a href="05-Jupyter.html#cells-and-code"><i class="fa fa-check"></i><b>5.3</b> Cells and code</a></li>
<li class="chapter" data-level="5.4" data-path="05-Jupyter.html"><a href="05-Jupyter.html#create-new-cells"><i class="fa fa-check"></i><b>5.4</b> Create new cells</a></li>
<li class="chapter" data-level="5.5" data-path="05-Jupyter.html"><a href="05-Jupyter.html#running-code"><i class="fa fa-check"></i><b>5.5</b> Running code</a></li>
<li class="chapter" data-level="5.6" data-path="05-Jupyter.html"><a href="05-Jupyter.html#saving-the-file"><i class="fa fa-check"></i><b>5.6</b> Saving the file</a></li>
<li class="chapter" data-level="5.7" data-path="05-Jupyter.html"><a href="05-Jupyter.html#title-cells-with-markdown"><i class="fa fa-check"></i><b>5.7</b> Title cells with markdown</a></li>
<li class="chapter" data-level="5.8" data-path="05-Jupyter.html"><a href="05-Jupyter.html#close-the-notebook"><i class="fa fa-check"></i><b>5.8</b> Close the notebook</a></li>
<li class="chapter" data-level="5.9" data-path="05-Jupyter.html"><a href="05-Jupyter.html#jup_vid_tut"><i class="fa fa-check"></i><b>5.9</b> Video tutorial</a></li>
</ul></li>
<li class="part"><span><b>Iterative rarefaction</b></span></li>
<li class="chapter" data-level="6" data-path="06-Iterative_rarefaction.html"><a href="06-Iterative_rarefaction.html"><i class="fa fa-check"></i><b>6</b> Iterative rarefaction intro</a>
<ul>
<li class="chapter" data-level="6.1" data-path="06-Iterative_rarefaction.html"><a href="06-Iterative_rarefaction.html#should-you-rarefy"><i class="fa fa-check"></i><b>6.1</b> Should you rarefy?</a></li>
<li class="chapter" data-level="6.2" data-path="06-Iterative_rarefaction.html"><a href="06-Iterative_rarefaction.html#using-iterations"><i class="fa fa-check"></i><b>6.2</b> Using iterations</a></li>
<li class="chapter" data-level="6.3" data-path="06-Iterative_rarefaction.html"><a href="06-Iterative_rarefaction.html#section-contents"><i class="fa fa-check"></i><b>6.3</b> Section contents</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="07-Rarefaction_and_random_seeds.html"><a href="07-Rarefaction_and_random_seeds.html"><i class="fa fa-check"></i><b>7</b> Random seeds</a>
<ul>
<li class="chapter" data-level="7.1" data-path="07-Rarefaction_and_random_seeds.html"><a href="07-Rarefaction_and_random_seeds.html#random-seed-notebook"><i class="fa fa-check"></i><b>7.1</b> Random seed notebook</a></li>
<li class="chapter" data-level="7.2" data-path="07-Rarefaction_and_random_seeds.html"><a href="07-Rarefaction_and_random_seeds.html#random-sampling"><i class="fa fa-check"></i><b>7.2</b> Random sampling</a></li>
<li class="chapter" data-level="7.3" data-path="07-Rarefaction_and_random_seeds.html"><a href="07-Rarefaction_and_random_seeds.html#sampling-with-replacement"><i class="fa fa-check"></i><b>7.3</b> Sampling with replacement</a></li>
<li class="chapter" data-level="7.4" data-path="07-Rarefaction_and_random_seeds.html"><a href="07-Rarefaction_and_random_seeds.html#setting-a-random-seed"><i class="fa fa-check"></i><b>7.4</b> Setting a random seed</a></li>
<li class="chapter" data-level="7.5" data-path="07-Rarefaction_and_random_seeds.html"><a href="07-Rarefaction_and_random_seeds.html#reset-seed"><i class="fa fa-check"></i><b>7.5</b> Reset seed</a></li>
<li class="chapter" data-level="7.6" data-path="07-Rarefaction_and_random_seeds.html"><a href="07-Rarefaction_and_random_seeds.html#random-seed-practice"><i class="fa fa-check"></i><b>7.6</b> Random seed practice</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="07-Rarefaction_and_random_seeds.html"><a href="07-Rarefaction_and_random_seeds.html#random-seed-question-1"><i class="fa fa-check"></i><b>7.6.1</b> Random seed: Question 1</a></li>
<li class="chapter" data-level="7.6.2" data-path="07-Rarefaction_and_random_seeds.html"><a href="07-Rarefaction_and_random_seeds.html#random-seed-question-2"><i class="fa fa-check"></i><b>7.6.2</b> Random seed: Question 2</a></li>
<li class="chapter" data-level="7.6.3" data-path="07-Rarefaction_and_random_seeds.html"><a href="07-Rarefaction_and_random_seeds.html#random-seed-question-3"><i class="fa fa-check"></i><b>7.6.3</b> Random seed: Question 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="08-Iterating_rarefaction.html"><a href="08-Iterating_rarefaction.html"><i class="fa fa-check"></i><b>8</b> Iterating rarefaction</a>
<ul>
<li class="chapter" data-level="8.1" data-path="08-Iterating_rarefaction.html"><a href="08-Iterating_rarefaction.html#iterating-rarefaction-dataset"><i class="fa fa-check"></i><b>8.1</b> Iterating rarefaction dataset</a></li>
<li class="chapter" data-level="8.2" data-path="08-Iterating_rarefaction.html"><a href="08-Iterating_rarefaction.html#iterating-rarefaction-setup"><i class="fa fa-check"></i><b>8.2</b> Iterating rarefaction setup</a></li>
<li class="chapter" data-level="8.3" data-path="08-Iterating_rarefaction.html"><a href="08-Iterating_rarefaction.html#rarefaction-iterations"><i class="fa fa-check"></i><b>8.3</b> Rarefaction iterations</a></li>
<li class="chapter" data-level="8.4" data-path="08-Iterating_rarefaction.html"><a href="08-Iterating_rarefaction.html#rng-vector-creation"><i class="fa fa-check"></i><b>8.4</b> RNG vector creation</a></li>
<li class="chapter" data-level="8.5" data-path="08-Iterating_rarefaction.html"><a href="08-Iterating_rarefaction.html#random-sampling-1"><i class="fa fa-check"></i><b>8.5</b> Random sampling</a></li>
<li class="chapter" data-level="8.6" data-path="08-Iterating_rarefaction.html"><a href="08-Iterating_rarefaction.html#sampling-with-replacement-1"><i class="fa fa-check"></i><b>8.6</b> Sampling with replacement</a></li>
<li class="chapter" data-level="8.7" data-path="08-Iterating_rarefaction.html"><a href="08-Iterating_rarefaction.html#setting-a-random-seed-1"><i class="fa fa-check"></i><b>8.7</b> Setting a random seed</a></li>
<li class="chapter" data-level="8.8" data-path="08-Iterating_rarefaction.html"><a href="08-Iterating_rarefaction.html#reset-seed-1"><i class="fa fa-check"></i><b>8.8</b> Reset seed</a></li>
<li class="chapter" data-level="8.9" data-path="08-Iterating_rarefaction.html"><a href="08-Iterating_rarefaction.html#random-seed-practice-1"><i class="fa fa-check"></i><b>8.9</b> Random seed practice</a>
<ul>
<li class="chapter" data-level="8.9.1" data-path="08-Iterating_rarefaction.html"><a href="08-Iterating_rarefaction.html#random-seed-question-1-1"><i class="fa fa-check"></i><b>8.9.1</b> Random seed: Question 1</a></li>
<li class="chapter" data-level="8.9.2" data-path="08-Iterating_rarefaction.html"><a href="08-Iterating_rarefaction.html#random-seed-question-2-1"><i class="fa fa-check"></i><b>8.9.2</b> Random seed: Question 2</a></li>
<li class="chapter" data-level="8.9.3" data-path="08-Iterating_rarefaction.html"><a href="08-Iterating_rarefaction.html#random-seed-question-3-1"><i class="fa fa-check"></i><b>8.9.3</b> Random seed: Question 3</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R community advanced analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="iterating_rarefaction_chap" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Chapter 8</span> Iterating rarefaction<a href="08-Iterating_rarefaction.html#iterating_rarefaction_chap" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<center>
<img src="figures/random_seeds.png" style="width:200px" />
</center>
<p>In this chapter we will create code to carry out iterative rarefaction.
For this we create a vector of random seeds, each used for a different iteration of rarefaction.
We will loop through these random seeds, using each random seed to carry out one iteration of rarefaction.
In the next chapters we will utilise this code to produce alpha and beta diveristy values that we will analyse.</p>
<div id="iterating-rarefaction-dataset" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Iterating rarefaction dataset<a href="08-Iterating_rarefaction.html#iterating-rarefaction-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<center>
<img src="figures/river.png" style="width:200px" />
</center>
<p>We will utilise the same dataset used in the <a href="https://neof-workshops.github.io/R_community_whqkt8/Course/02-Dataset_and_workflow.html#dataset">R community analysis workshop</a>.</p>
<p>Below are brief bullet points about the data:</p>
<ul>
<li>It is a 16S dataset of ASV counts with taxonomy and phylogeny produced by QIIME2</li>
<li>The samples come from surface water from the Durance River in the south-east of France</li>
<li>There are three sampling site on an anthropisation gradient (low to high agriculture)
<ul>
<li>Upper Durance (UD)</li>
<li>Middle Durance (MD)</li>
<li>Lower Durance (LD)</li>
</ul></li>
<li>Four different media approaches were used to produce bacterial lawns that were sequenced.
<ul>
<li>Environmental sample (ENV): No media used, frozen at -20°C.</li>
<li>TSA 10% incubated at 28°C for 2 days.</li>
<li>KBC incubated at 28°C for 2 days.</li>
<li>CVP incubated at 28°C for 3 days.</li>
</ul></li>
</ul>
</div>
<div id="iterating-rarefaction-setup" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Iterating rarefaction setup<a href="08-Iterating_rarefaction.html#iterating-rarefaction-setup" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>First, create a new R jupyter-notebook called "Iterating_rarefaction.ipynb".</p>
<p>At the top of this notebook create a code cell to load in the various packages and data we need. The code is below:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r Rchunk"><code class="sourceCode r"><span id="cb18-1"><a href="08-Iterating_rarefaction.html#cb18-1" tabindex="-1"></a><span class="co">#Libaries</span></span>
<span id="cb18-2"><a href="08-Iterating_rarefaction.html#cb18-2" tabindex="-1"></a></span>
<span id="cb18-3"><a href="08-Iterating_rarefaction.html#cb18-3" tabindex="-1"></a><span class="co">#Data</span></span></code></pre></div>
</div>
<div id="rarefaction-iterations" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Rarefaction iterations<a href="08-Iterating_rarefaction.html#rarefaction-iterations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We need to choose the number of iterations we are going to carry out.</p>
<p>For our <strong>practice</strong> we will use <strong>10 iterations</strong> for speed.
In your real analysis I would recommend using <strong>1000 iterations</strong>.</p>
<p>Let's create a variable for our number of iterations.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r Rchunk"><code class="sourceCode r"><span id="cb19-1"><a href="08-Iterating_rarefaction.html#cb19-1" tabindex="-1"></a><span class="co">#Number of rarefaction iterations to be carried out</span></span>
<span id="cb19-2"><a href="08-Iterating_rarefaction.html#cb19-2" tabindex="-1"></a><span class="co">#Using 10 here for speed, real analysis should use 1000</span></span>
<span id="cb19-3"><a href="08-Iterating_rarefaction.html#cb19-3" tabindex="-1"></a>rarefaction_iters <span class="ot">&lt;-</span> <span class="dv">10</span></span></code></pre></div>
</div>
<div id="rng-vector-creation" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> RNG vector creation<a href="08-Iterating_rarefaction.html#rng-vector-creation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can now carry out <strong>Random Number Generation (RNG)</strong> to create a number of random seeds equal to the number of iterations planned.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r Rchunk"><code class="sourceCode r"><span id="cb20-1"><a href="08-Iterating_rarefaction.html#cb20-1" tabindex="-1"></a><span class="co">#Create rngseed vector</span></span>
<span id="cb20-2"><a href="08-Iterating_rarefaction.html#cb20-2" tabindex="-1"></a><span class="co">#Set seed for reproducibility</span></span>
<span id="cb20-3"><a href="08-Iterating_rarefaction.html#cb20-3" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2605</span>)</span>
<span id="cb20-4"><a href="08-Iterating_rarefaction.html#cb20-4" tabindex="-1"></a><span class="co">#Sample 10 (number of iters) values from the number range 1-100,000</span></span>
<span id="cb20-5"><a href="08-Iterating_rarefaction.html#cb20-5" tabindex="-1"></a>rngseed_vec <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">100000</span>, <span class="at">size =</span> rarefaction_iters, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb20-6"><a href="08-Iterating_rarefaction.html#cb20-6" tabindex="-1"></a><span class="co">#Print out vector</span></span>
<span id="cb20-7"><a href="08-Iterating_rarefaction.html#cb20-7" tabindex="-1"></a>rngseed_vec</span>
<span id="cb20-8"><a href="08-Iterating_rarefaction.html#cb20-8" tabindex="-1"></a><span class="co">#Save our rngseed vector</span></span>
<span id="cb20-9"><a href="08-Iterating_rarefaction.html#cb20-9" tabindex="-1"></a><span class="fu">save</span>(rngseed_vec, <span class="at">file=</span><span class="st">&quot;rngseeds.RData&quot;</span>)</span>
<span id="cb20-10"><a href="08-Iterating_rarefaction.html#cb20-10" tabindex="-1"></a><span class="co">#Reset seed</span></span>
<span id="cb20-11"><a href="08-Iterating_rarefaction.html#cb20-11" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="cn">NULL</span>)</span></code></pre></div>
<p>There are a lot of steps above. These are:</p>
<ul>
<li><strong>Setting the random seed:</strong> We carry this out so we will always get the same rngseed vector that will be used for the rarefaction iterations. This is important so you will always get the same results if you need to rework some analysis, stats, or plots. ALso useful here so you get the same results as the instructor and other attendees.</li>
<li><strong>Creating the rngseed vector:</strong> We use our old friend <code>sample()</code> to create a random number for each iteration we will carry out.
<ul>
<li>We arbitrarily sample from the numbers 1-100,000, you could change this to a larger range in your future research.</li>
<li>We use our previous object <code>rarefaction_iters</code> as <code>size=</code> to produce a random number for each of our iterations.</li>
<li>We carry this out without replacement so none of our rarefaction iterations are identical.</li>
</ul></li>
<li><strong>Save the rngseed vector:</strong> We save the vector as a file. We will load this in our alpha and beta diversity notebooks to be used for iterative rarefaction. This is also useful so you have a backup file of the rngseed vectors.</li>
<li><strong>Reset seed:</strong> Always good to reset the seed at the end of a cell.</li>
</ul>
</div>
<div id="random-sampling-1" class="section level2 hasAnchor" number="8.5">
<h2><span class="header-section-number">8.5</span> Random sampling<a href="08-Iterating_rarefaction.html#random-sampling-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<center>
<img src="figures/random_sampling.png" style="width:200px; background:white; border-radius:5px" />
</center>
<p>To demonstrate this we will use the R function <code>sample()</code>.
This function randomly samples a set of numbers.</p>
<p>Create the below code in a code cell.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r Rchunk"><code class="sourceCode r"><span id="cb21-1"><a href="08-Iterating_rarefaction.html#cb21-1" tabindex="-1"></a><span class="co">#Create a vector containing the numbers 0 to 10</span></span>
<span id="cb21-2"><a href="08-Iterating_rarefaction.html#cb21-2" tabindex="-1"></a>num_vec <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb21-3"><a href="08-Iterating_rarefaction.html#cb21-3" tabindex="-1"></a><span class="co">#Randomly sample 5 of these numbers</span></span>
<span id="cb21-4"><a href="08-Iterating_rarefaction.html#cb21-4" tabindex="-1"></a><span class="fu">sample</span>(<span class="at">x =</span> num_vec, <span class="at">size =</span> <span class="dv">5</span>)</span></code></pre></div>
<p>If you run the code you will get five random single digit numbers.</p>
<p>Run this multiple times and you will hopefully see the sampled numbers are different every time.</p>
</div>
<div id="sampling-with-replacement-1" class="section level2 hasAnchor" number="8.6">
<h2><span class="header-section-number">8.6</span> Sampling with replacement<a href="08-Iterating_rarefaction.html#sampling-with-replacement-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<center>
<img src="figures/balls.png" style="width:200px" />
</center>
<p>You may also notice that within each sample there are no repeating numbers.
You can change this by adding the options <code>replace = TRUE</code>.</p>
<p>Try this out in a new cell.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r Rchunk"><code class="sourceCode r"><span id="cb22-1"><a href="08-Iterating_rarefaction.html#cb22-1" tabindex="-1"></a><span class="co">#Randomly sample 5 of these numbers with replacement</span></span>
<span id="cb22-2"><a href="08-Iterating_rarefaction.html#cb22-2" tabindex="-1"></a><span class="fu">sample</span>(<span class="at">x =</span> num_vec, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Run this a few times and you will hopefully notice that there are repeats.</p>
<p>When sampling with replacement you put back any results back into the sampling pool.
When sampling without replacement you don't put back any results into the sampling pool.</p>
<p>The famous example is sampling green and yellow balls from a bag.
If you had a bag with 1000 balls and you wanted a rough idea of the ratio of yellow and green balls you could count the number of these balls of only 50.
Without replacement you would take out a ball, mark its colour and throw it in a separate container.
With replacement you would take out a ball, mark its colour and put it back into the intial bag, meanig it could possibly be recounted.</p>
<p>One advantage of sampling with replacement is that your sampling size can be larger than your actual population size.
For example, you could create a random sampling of 50 with a bag containing 10 balls with replacement.
This would not work without replacement.
The below script will cause R to produce an error saying it can be done with replacement.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r Rchunk"><code class="sourceCode r"><span id="cb23-1"><a href="08-Iterating_rarefaction.html#cb23-1" tabindex="-1"></a><span class="co">#Randomly sample 5 of these numbers with replacement</span></span>
<span id="cb23-2"><a href="08-Iterating_rarefaction.html#cb23-2" tabindex="-1"></a><span class="fu">sample</span>(<span class="at">x =</span> num_vec, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Importantly for us rarefaction uses sampling without replacement.</p>
</div>
<div id="setting-a-random-seed-1" class="section level2 hasAnchor" number="8.7">
<h2><span class="header-section-number">8.7</span> Setting a random seed<a href="08-Iterating_rarefaction.html#setting-a-random-seed-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<center>
<img src="figures/set_a_seed.png" style="width:400px" />
</center>
<p>We'll sample, without replacement, the numbers one more time in a new cell.
However, this time we will set the random seed with the function <code>seet.seed()</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r Rchunk"><code class="sourceCode r"><span id="cb24-1"><a href="08-Iterating_rarefaction.html#cb24-1" tabindex="-1"></a><span class="co">#Set random seed</span></span>
<span id="cb24-2"><a href="08-Iterating_rarefaction.html#cb24-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb24-3"><a href="08-Iterating_rarefaction.html#cb24-3" tabindex="-1"></a><span class="co">#Randomly sample 12 of these numbers without replacement</span></span>
<span id="cb24-4"><a href="08-Iterating_rarefaction.html#cb24-4" tabindex="-1"></a><span class="fu">sample</span>(<span class="at">x =</span> num_vec, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb24-5"><a href="08-Iterating_rarefaction.html#cb24-5" tabindex="-1"></a><span class="co">#Reset random seed</span></span>
<span id="cb24-6"><a href="08-Iterating_rarefaction.html#cb24-6" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="cn">NULL</span>)</span></code></pre></div>
<p>Before we explain the code further, try running the cell multiple times.
If it is identical to the above code you will get the numbers "9, 5, 4, 3, &amp; 6".</p>
<p>How come you are getting these results if it is random?</p>
<p>True randomness is pretty much impossible, especially in computing.
To get around this many programs use seeds to determine how random tasks will be carried out.
Various programs that use random seeds include:</p>
<ul>
<li>Sampling tools such as <code>sample()</code> and rarefaction</li>
<li>Creating bootstrapped phylogenies</li>
<li>Creating procedural content such as building Minecraft worlds</li>
</ul>
<p>Therefore if you run a tool that will use randomness you will always get the same results if:</p>
<ul>
<li>You use the same random seed</li>
<li>You use the same data</li>
<li>You use the same replacement method (with or without)</li>
</ul>
<p>In fact, run the below code in a new code cell and you may notice a similarity with your previous output.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r Rchunk"><code class="sourceCode r"><span id="cb25-1"><a href="08-Iterating_rarefaction.html#cb25-1" tabindex="-1"></a><span class="co">#Set random seed</span></span>
<span id="cb25-2"><a href="08-Iterating_rarefaction.html#cb25-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb25-3"><a href="08-Iterating_rarefaction.html#cb25-3" tabindex="-1"></a><span class="co">#Create a vector containing the numbers 0 to 10</span></span>
<span id="cb25-4"><a href="08-Iterating_rarefaction.html#cb25-4" tabindex="-1"></a>larger_num_vec <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">19</span></span>
<span id="cb25-5"><a href="08-Iterating_rarefaction.html#cb25-5" tabindex="-1"></a><span class="co">#Randomly sample 5 of these numbers</span></span>
<span id="cb25-6"><a href="08-Iterating_rarefaction.html#cb25-6" tabindex="-1"></a><span class="fu">sample</span>(<span class="at">x =</span> num_vec, <span class="at">size =</span> <span class="dv">5</span>)</span>
<span id="cb25-7"><a href="08-Iterating_rarefaction.html#cb25-7" tabindex="-1"></a><span class="co">#Reset random seed</span></span>
<span id="cb25-8"><a href="08-Iterating_rarefaction.html#cb25-8" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="cn">NULL</span>)</span></code></pre></div>
<p>That's right, <code>sample()</code> will always take the 10th (9/19), 6th (5/15), 5th (4/14), 4th (3/13), and 7th (6/16) values if it is given the random seed of (1234) and provided with a 11 length vector.</p>
<p>Setting our randomness is incredible beneficial for reproducibility in research.</p>
<p>When you carry out analysis you may need to redo some work.
This could be due to reviewer comments or you want to incorporate some new methods.
As long as you saved the random seeds you used you can get the same results where you need to.
It also means others can replicate your results.</p>
</div>
<div id="reset-seed-1" class="section level2 hasAnchor" number="8.8">
<h2><span class="header-section-number">8.8</span> Reset seed<a href="08-Iterating_rarefaction.html#reset-seed-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<center>
<img src="figures/reset_seed.png" style="width:400px" />
</center>
<p>We set a random seed at the start of the cell for reproducibility and control, but why do we then run the line <code>set.seed(NULL)</code>?</p>
<p>The normal operation of R means that, in effect, its random seed changes every time it is used.
This means R normally randomly determines randomness.
This is how it should be until we want to set the randomness.
It is therefore good practice to set the seed to <code>NULL</code> after you have utilised your set seeds.
This will revert the seed to its normal random operations.</p>
<p>One last point to note is R versions.
Version 3.6 changed R's sampling methods, therefore if you use Version 3.5 or below you will get different results than we have got.
Hopefully the R developers will not change this in a later version again.</p>
</div>
<div id="random-seed-practice-1" class="section level2 hasAnchor" number="8.9">
<h2><span class="header-section-number">8.9</span> Random seed practice<a href="08-Iterating_rarefaction.html#random-seed-practice-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<center>
<img src="figures/seed_sowing.png" style="width:200px" />
</center>
<p>Brilliant! To reinforce the above knowledge try out the following challenges.</p>
<p>First create the following vector:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r Rchunk"><code class="sourceCode r"><span id="cb26-1"><a href="08-Iterating_rarefaction.html#cb26-1" tabindex="-1"></a>second_millenium <span class="ot">&lt;-</span> <span class="dv">1001</span><span class="sc">:</span><span class="dv">2000</span></span></code></pre></div>
<p><strong>Note:</strong> Remember it is best practice to <code>set.seed(NULL)</code> at the end of a code cell.</p>
<div id="random-seed-question-1-1" class="section level3 hasAnchor" number="8.9.1">
<h3><span class="header-section-number">8.9.1</span> Random seed: Question 1<a href="08-Iterating_rarefaction.html#random-seed-question-1-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Sample the object <code>second_millenium</code> with the following parameters:</p>
<ul>
<li>Extract 10 values</li>
<li>Without replacement</li>
<li>Use the random seed <code>489</code></li>
</ul>
What is the fourth number in the produced vector?
<div id="radio_JDSAUUYWWT" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_JDSAUUYWWT" value=""></input> <span><strong>1120</strong></span></label><label><input type="radio" autocomplete="off" name="radio_JDSAUUYWWT" value="answer"></input> <span><strong>1369</strong></span></label><label><input type="radio" autocomplete="off" name="radio_JDSAUUYWWT" value=""></input> <span><strong>1744</strong></span></label>
</div>
</div>
<div id="random-seed-question-2-1" class="section level3 hasAnchor" number="8.9.2">
<h3><span class="header-section-number">8.9.2</span> Random seed: Question 2<a href="08-Iterating_rarefaction.html#random-seed-question-2-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Sample the object <code>second_millenium</code> with the following parameters:</p>
<ul>
<li>Extract 24 values</li>
<li>Without replacement</li>
<li>Use the answer to the first question as the random seed</li>
</ul>
What is the 16th number in the produced vector?
<div id="radio_TMFYXBZEWX" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_TMFYXBZEWX" value=""></input> <span><strong>1120</strong></span></label><label><input type="radio" autocomplete="off" name="radio_TMFYXBZEWX" value=""></input> <span><strong>1369</strong></span></label><label><input type="radio" autocomplete="off" name="radio_TMFYXBZEWX" value="answer"></input> <span><strong>1744</strong></span></label>
</div>
</div>
<div id="random-seed-question-3-1" class="section level3 hasAnchor" number="8.9.3">
<h3><span class="header-section-number">8.9.3</span> Random seed: Question 3<a href="08-Iterating_rarefaction.html#random-seed-question-3-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Sample the object <code>second_millenium</code> with the following parameters:</p>
<ul>
<li>Extract a number of values equal to the answer of the second question</li>
<li>With replacement</li>
<li>Use the answer to the first question as the random seed</li>
</ul>
What is the 999th number in the produced vector?
<div id="radio_WSZCTKUYKS" class="webex-radiogroup">
<label><input type="radio" autocomplete="off" name="radio_WSZCTKUYKS" value="answer"></input> <span><strong>1120</strong></span></label><label><input type="radio" autocomplete="off" name="radio_WSZCTKUYKS" value=""></input> <span><strong>1369</strong></span></label><label><input type="radio" autocomplete="off" name="radio_WSZCTKUYKS" value=""></input> <span><strong>1744</strong></span></label>
</div>
<p>Once you are happy you can save then close and halt your "Random_seeds.ipynb" notebook.</p>
<p>Hopefully this has given you a good undertstanding of the principle of random seeds. With this you can continue onto iterative rarefaction.</p>

</div>
</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script>
            </section>

          </div>
        </div>
      </div>
<a href="07-Rarefaction_and_random_seeds.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
